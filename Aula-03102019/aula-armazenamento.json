{"paragraphs":[{"text":"\n\nval data1 = Seq((\"I\", \"1000001\", \"id_cliente\", \"1\", \"roberto\"), (\"I\", \"1000002\", \"id_cliente\", \"2\", \"joao\"), (\"I\", \"1000003\", \"id_cliente\", \"3\", \"maria\"))\nval rdd1 = spark.sparkContext.parallelize(data1)\nval dfCliente1 = rdd1.toDF(\"operacao\", \"sequencial\", \"primary_key\", \"id_cliente\", \"nm_cliente\")\ndfCliente1.printSchema()\ndfCliente1.show()\n\ndfCliente1.coalesce(1).write.mode(\"append\").parquet(\"s3://datalake01-raw/tb_cliente/\")","user":"anonymous","dateUpdated":"2019-10-03T17:07:10+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1570119737033_-1800526377","id":"20191003-010622_1423857959","dateCreated":"2019-10-03T16:22:17+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:717","dateFinished":"2019-10-03T16:40:03+0000","dateStarted":"2019-10-03T16:40:02+0000","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"root\n |-- operacao: string (nullable = true)\n |-- sequencial: string (nullable = true)\n |-- primary_key: string (nullable = true)\n |-- id_cliente: string (nullable = true)\n |-- nm_cliente: string (nullable = true)\n\n+--------+----------+-----------+----------+----------+\n|operacao|sequencial|primary_key|id_cliente|nm_cliente|\n+--------+----------+-----------+----------+----------+\n|       I|   1000001| id_cliente|         1|   roberto|\n|       I|   1000002| id_cliente|         2|      joao|\n|       I|   1000003| id_cliente|         3|     maria|\n+--------+----------+-----------+----------+----------+\n\ndata1: Seq[(String, String, String, String, String)] = List((I,1000001,id_cliente,1,roberto), (I,1000002,id_cliente,2,joao), (I,1000003,id_cliente,3,maria))\nrdd1: org.apache.spark.rdd.RDD[(String, String, String, String, String)] = ParallelCollectionRDD[63] at parallelize at <console>:28\ndfCliente1: org.apache.spark.sql.DataFrame = [operacao: string, sequencial: string ... 3 more fields]\n"}]},"runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":["http://ip-172-31-70-66.ec2.internal:4040/jobs/job?id=19","http://ip-172-31-70-66.ec2.internal:4040/jobs/job?id=20","http://ip-172-31-70-66.ec2.internal:4040/jobs/job?id=21"],"interpreterSettingId":"spark"}}},{"text":"\n\nval data1 = Seq((\"U\", \"1000010\", \"id_cliente\", \"1\", \"roberto 2\"), (\"U\", \"1000011\", \"id_cliente\", \"2\", \"joao 2\"), (\"U\", \"1000012\", \"id_cliente\", \"3\", \"maria 2\"))\nval rdd1 = spark.sparkContext.parallelize(data1)\nval dfCliente1 = rdd1.toDF(\"operacao\", \"sequencial\", \"primary_key\", \"id_cliente\", \"nm_cliente\")\ndfCliente1.printSchema()\ndfCliente1.show()\n\ndfCliente1.coalesce(1).write.mode(\"append\").parquet(\"s3://datalake01-raw/tb_cliente/\")dfCliente1.coalesce(1).write.mode(\"append\").parquet(\"s3://datalake01-raw/tb_cliente/\")","user":"anonymous","dateUpdated":"2019-10-03T17:07:13+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1570119737033_-583943419","id":"20191003-004800_2049287635","dateCreated":"2019-10-03T16:22:17+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:718","dateFinished":"2019-10-03T16:40:07+0000","dateStarted":"2019-10-03T16:40:06+0000","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"root\n |-- operacao: string (nullable = true)\n |-- sequencial: string (nullable = true)\n |-- primary_key: string (nullable = true)\n |-- id_cliente: string (nullable = true)\n |-- nm_cliente: string (nullable = true)\n\n+--------+----------+-----------+----------+----------+\n|operacao|sequencial|primary_key|id_cliente|nm_cliente|\n+--------+----------+-----------+----------+----------+\n|       U|   1000010| id_cliente|         1| roberto 2|\n|       U|   1000011| id_cliente|         2|    joao 2|\n|       U|   1000012| id_cliente|         3|   maria 2|\n+--------+----------+-----------+----------+----------+\n\ndata1: Seq[(String, String, String, String, String)] = List((U,1000010,id_cliente,1,roberto 2), (U,1000011,id_cliente,2,joao 2), (U,1000012,id_cliente,3,maria 2))\nrdd1: org.apache.spark.rdd.RDD[(String, String, String, String, String)] = ParallelCollectionRDD[74] at parallelize at <console>:28\ndfCliente1: org.apache.spark.sql.DataFrame = [operacao: string, sequencial: string ... 3 more fields]\n"}]},"runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":["http://ip-172-31-70-66.ec2.internal:4040/jobs/job?id=22","http://ip-172-31-70-66.ec2.internal:4040/jobs/job?id=23","http://ip-172-31-70-66.ec2.internal:4040/jobs/job?id=24"],"interpreterSettingId":"spark"}}},{"user":"anonymous","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1570120616902_-219316545","id":"20191003-163656_1584642135","dateCreated":"2019-10-03T16:36:56+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:1336","text":"val df = spark.read.parquet(\"s3://datalake01-raw/tb_cliente/\")\ndf.printSchema()","dateUpdated":"2019-10-03T16:40:13+0000","dateFinished":"2019-10-03T16:40:14+0000","dateStarted":"2019-10-03T16:40:13+0000","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"root\n |-- operacao: string (nullable = true)\n |-- sequencial: string (nullable = true)\n |-- primary_key: string (nullable = true)\n |-- id_cliente: string (nullable = true)\n |-- nm_cliente: string (nullable = true)\n\ndf: org.apache.spark.sql.DataFrame = [operacao: string, sequencial: string ... 3 more fields]\n"}]},"runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":["http://ip-172-31-70-66.ec2.internal:4040/jobs/job?id=25"],"interpreterSettingId":"spark"}}},{"user":"anonymous","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1570120675529_-813923722","id":"20191003-163755_412135565","dateCreated":"2019-10-03T16:37:55+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:1449","text":"val df = spark.read.parquet(\"s3://datalake01-raw/tb_cliente/\")\ndf.show()","dateUpdated":"2019-10-03T16:40:20+0000","dateFinished":"2019-10-03T16:40:21+0000","dateStarted":"2019-10-03T16:40:20+0000","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+--------+----------+-----------+----------+----------+\n|operacao|sequencial|primary_key|id_cliente|nm_cliente|\n+--------+----------+-----------+----------+----------+\n|       U|   1000010| id_cliente|         1| roberto 2|\n|       U|   1000011| id_cliente|         2|    joao 2|\n|       U|   1000012| id_cliente|         3|   maria 2|\n|       I|   1000001| id_cliente|         1|   roberto|\n|       I|   1000002| id_cliente|         2|      joao|\n|       I|   1000003| id_cliente|         3|     maria|\n+--------+----------+-----------+----------+----------+\n\ndf: org.apache.spark.sql.DataFrame = [operacao: string, sequencial: string ... 3 more fields]\n"}]},"runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":["http://ip-172-31-70-66.ec2.internal:4040/jobs/job?id=26","http://ip-172-31-70-66.ec2.internal:4040/jobs/job?id=27","http://ip-172-31-70-66.ec2.internal:4040/jobs/job?id=28"],"interpreterSettingId":"spark"}}},{"user":"anonymous","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1570120892988_-498829441","id":"20191003-164132_1817370311","dateCreated":"2019-10-03T16:41:32+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:1824","text":"\n\ndf.coalesce(1).write.mode(\"append\").parquet(\"s3://datalake01-trusted/tb_cliente/year_partition=2019/month_partition=10\")","dateUpdated":"2019-10-03T17:10:17+0000","dateFinished":"2019-10-03T16:43:06+0000","dateStarted":"2019-10-03T16:42:57+0000","results":{"code":"SUCCESS","msg":[]},"runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":["http://ip-172-31-70-66.ec2.internal:4040/jobs/job?id=29"],"interpreterSettingId":"spark"}}},{"user":"anonymous","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1570121120254_1034947333","id":"20191003-164520_140908855","dateCreated":"2019-10-03T16:45:20+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:1921","text":"\n\nval df = spark.read.parquet(\"s3://datalake01-trusted/tb_cliente/year_partition=2019/month_partition=10\")\ndf.show()","dateUpdated":"2019-10-03T17:11:59+0000","dateFinished":"2019-10-03T16:45:54+0000","dateStarted":"2019-10-03T16:45:46+0000","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+--------+----------+-----------+----------+----------+\n|operacao|sequencial|primary_key|id_cliente|nm_cliente|\n+--------+----------+-----------+----------+----------+\n|       U|   1000010| id_cliente|         1| roberto 2|\n|       U|   1000011| id_cliente|         2|    joao 2|\n|       U|   1000012| id_cliente|         3|   maria 2|\n|       I|   1000001| id_cliente|         1|   roberto|\n|       I|   1000002| id_cliente|         2|      joao|\n|       I|   1000003| id_cliente|         3|     maria|\n+--------+----------+-----------+----------+----------+\n\ndf: org.apache.spark.sql.DataFrame = [operacao: string, sequencial: string ... 3 more fields]\n"}]},"runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":["http://ip-172-31-70-66.ec2.internal:4040/jobs/job?id=30","http://ip-172-31-70-66.ec2.internal:4040/jobs/job?id=31"],"interpreterSettingId":"spark"}}},{"user":"anonymous","dateUpdated":"2019-10-03T16:53:13+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1570119737034_-1210308512","id":"20191003-011934_679604144","dateCreated":"2019-10-03T16:22:17+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:721","text":"%spark.pyspark\nimport pyspark.sql.functions as F\ndf = spark.read.parquet(\"s3://datalake01-trusted/tb_cliente/\")\nprimary_key = df.select(\"primary_key\").first()[0]\ndfAgg = (df.groupBy(primary_key).agg(F.max(\"sequencial\").alias(\"sequencial\")))\ndfAgg.show()\n","dateFinished":"2019-10-03T16:53:16+0000","dateStarted":"2019-10-03T16:53:13+0000","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+----------+----------+\n|id_cliente|sequencial|\n+----------+----------+\n|         3|   1000012|\n|         1|   1000010|\n|         2|   1000011|\n+----------+----------+\n\n"}]},"runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":["http://ip-172-31-70-66.ec2.internal:4040/jobs/job?id=36","http://ip-172-31-70-66.ec2.internal:4040/jobs/job?id=37","http://ip-172-31-70-66.ec2.internal:4040/jobs/job?id=38","http://ip-172-31-70-66.ec2.internal:4040/jobs/job?id=39","http://ip-172-31-70-66.ec2.internal:4040/jobs/job?id=40","http://ip-172-31-70-66.ec2.internal:4040/jobs/job?id=41","http://ip-172-31-70-66.ec2.internal:4040/jobs/job?id=42"],"interpreterSettingId":"spark"}}},{"text":"%spark.pyspark\n\ndf.join(dfAgg, dfAgg.columns).coalesce(1).write.mode(\"append\").parquet(\"s3://datalake01-refined/tb_cliente/date_partition=2019-10-03\")\n","user":"anonymous","dateUpdated":"2019-10-03T17:13:11+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1570121511233_-1979653202","id":"20191003-165151_1760388332","dateCreated":"2019-10-03T16:51:51+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:2067","dateFinished":"2019-10-03T17:04:09+0000","dateStarted":"2019-10-03T17:03:57+0000","results":{"code":"SUCCESS","msg":[]},"runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":["http://ip-172-31-70-66.ec2.internal:4040/jobs/job?id=47","http://ip-172-31-70-66.ec2.internal:4040/jobs/job?id=48"],"interpreterSettingId":"spark"}}},{"text":"%spark.pyspark\ndfRefined = spark.read.parquet(\"s3://datalake01-refined/tb_cliente/date_partition=2019-10-03\")\ndfRefined.show()","user":"anonymous","dateUpdated":"2019-10-03T17:04:13+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1570121782371_-727481912","id":"20191003-165622_1336231953","dateCreated":"2019-10-03T16:56:22+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:2302","dateFinished":"2019-10-03T17:04:14+0000","dateStarted":"2019-10-03T17:04:13+0000","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+----------+----------+--------+-----------+----------+--------------+---------------+\n|id_cliente|sequencial|operacao|primary_key|nm_cliente|year_partition|month_partition|\n+----------+----------+--------+-----------+----------+--------------+---------------+\n|         1|   1000010|       U| id_cliente| roberto 2|          2019|             10|\n|         2|   1000011|       U| id_cliente|    joao 2|          2019|             10|\n|         3|   1000012|       U| id_cliente|   maria 2|          2019|             10|\n+----------+----------+--------+-----------+----------+--------------+---------------+\n\n"}]},"runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":["http://ip-172-31-70-66.ec2.internal:4040/jobs/job?id=49","http://ip-172-31-70-66.ec2.internal:4040/jobs/job?id=50"],"interpreterSettingId":"spark"}}},{"text":"%spark.pyspark\n","user":"anonymous","dateUpdated":"2019-10-03T16:57:31+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1570121851930_223330641","id":"20191003-165731_318102654","dateCreated":"2019-10-03T16:57:31+0000","status":"READY","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:2419"}],"name":"aula-armazenamento","id":"2EQN75X2Y","noteParams":{},"noteForms":{},"angularObjects":{},"config":{"isZeppelinNotebookCronEnable":false,"looknfeel":"default","personalizedMode":"false"},"info":{}}